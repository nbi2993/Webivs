<!-- FILE: /public/components/fab-container.html -->
<!-- VERSION: 2.10 - Chatbot Fully Removed -->
<!-- DESCRIPTION: Optimized HTML for Floating Action Buttons. All chatbot functionality and related code has been removed. -->

<!-- Thay đổi: Nâng vị trí các nút chức năng lên để tránh bị che bởi thanh điều hướng dưới cùng. -->
<div id="fab-container" class="fixed right-4 z-30 flex flex-col items-end space-y-3 bottom-28 md:bottom-8">
    
    <!-- Nút Cuộn lên đầu trang -->
    <button id="scroll-to-top-btn" title="Lên đầu trang" aria-label="Lên đầu trang"
            class="fab-item flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 bg-neutral-600 dark:bg-neutral-700 text-white rounded-full shadow-lg hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-all duration-300 ease-out transform active:scale-90 opacity-0 scale-90 pointer-events-none">
        <i class="fas fa-arrow-up text-base sm:text-lg"></i>
    </button>

    <!-- Nút FAB Chia Sẻ -->
    <div class="relative group/fab">
        <button id="share-main-btn" title="Chia sẻ" aria-label="Mở menu chia sẻ" aria-haspopup="true" aria-expanded="false" aria-controls="share-options"
                class="fab-item flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full shadow-xl transition-transform duration-200 transform hover:scale-110 active:scale-95">
            <i class="fas fa-share-alt text-xl sm:text-2xl"></i>
        </button>
        <div id="share-options" 
             class="fab-submenu-panel hidden absolute bottom-full mb-2 p-2 bg-white dark:bg-neutral-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 flex-col space-y-1.5 transition-all duration-200 ease-out opacity-0 scale-95 transform origin-bottom-right pointer-events-none right-0 w-auto max-w-[calc(100vw-32px)] md:min-w-[200px] md:w-auto"
             role="menu" aria-orientation="vertical" aria-labelledby="share-main-btn">
            <!-- Nội dung cho share-options sẽ được JavaScript chèn vào đây -->
        </div>
    </div>

    <!-- Nút FAB Liên Hệ (chính) -->
    <div class="relative group/fab">
        <button id="contact-main-btn" title="Liên hệ" aria-label="Mở menu liên hệ" aria-haspopup="true" aria-expanded="false" aria-controls="contact-options"
                class="fab-item flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-xl transition-transform duration-200 transform hover:scale-110 active:scale-95">
            <i class="fas fa-comment-dots text-xl sm:text-2xl"></i>
        </button>
        <div id="contact-options" 
             class="fab-submenu-panel hidden absolute bottom-full mb-2 p-2 bg-white dark:bg-neutral-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 flex-col space-y-1.5 transition-all duration-200 ease-out opacity-0 scale-95 transform origin-bottom-right pointer-events-none right-0 w-auto max-w-[calc(100vw-32px)] md:min-w-[220px] md:w-auto"
             role="menu" aria-orientation="vertical" aria-labelledby="contact-main-btn">
            <!-- Nội dung cho contact-options sẽ được JavaScript chèn vào đây -->
        </div>
    </div>
</div>

<!-- 
 CSS cho các mục con của FAB. 
 Nên được chuyển vào tệp CSS chính để tối ưu, nhưng để ở đây để đảm bảo component hoạt lập.
-->
<style>
    .fab-submenu-item {
        display: flex;
        align-items: center;
        padding: 0.6rem 0.85rem;
        font-size: 0.9rem;
        color: #374151; /* gray-700 */
        border-radius: 0.375rem; /* rounded-md */
        transition: background-color 0.2s, color 0.2s;
        text-decoration: none;
        cursor: pointer;
        text-align: left;
        width: 100%;
    }
    .fab-submenu-item:hover {
        background-color: #f3f4f6; /* gray-100 */
        color: #2563eb; /* blue-600 */
    }
    .dark .fab-submenu-item {
        color: #d1d5db; /* gray-300 */
    }
    .dark .fab-submenu-item:hover {
        background-color: #374151; /* gray-700 */
        color: #60a5fa; /* blue-400 */
    }
    .fab-submenu-item i.fa-fw {
        margin-right: 0.75rem;
        width: 1.25em; 
        text-align: center;
        font-size: 1.1em;
    }
</style>

<script>
    // =================================================================
    //  UTILITIES (Included here for robustness, in case loadComponents.js isn't fully loaded first)
    // =================================================================
    function componentLog(message, level = 'info') {
        console[level](`[IVS Components] ${message}`);
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func.apply(this, args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // =================================================================
    //  FAB LOGIC
    // =================================================================

    // Cần định nghĩa IVSFabController để loadComponents.js có thể gọi
    const IVSFabController = {
        init() {
            this.cacheDOM();
            if (!this.fabContainer) {
                componentLog("FAB container not found. FAB logic will not run.", "warn");
                return;
            }
            this.populateMenus();
            this.bindEvents();
            componentLog("FAB Controller Initialized.", "info");
        },

        cacheDOM() {
            this.fabContainer = document.getElementById('fab-container');
            this.scrollToTopBtn = document.getElementById('scroll-to-top-btn');
            this.buttonsWithSubmenu = this.fabContainer?.querySelectorAll('button[aria-haspopup="true"]') || [];
        },
        
        populateMenus() {
            const contactMenu = document.getElementById('contact-options');
            const shareMenu = document.getElementById('share-options');

            if (contactMenu) this.populateContactOptions(contactMenu);
            if (shareMenu) this.populateShareOptions(shareMenu);
        },

        populateContactOptions(element) {
            const contacts = [
                { key: "fab_call_hotline", text: "Hotline", href: "tel:+84896920547", icon: "fas fa-phone", color: "text-orange-500" },
                { key: "fab_send_email", text: "Email", href: "mailto:info@ivsacademy.edu.vn", icon: "fas fa-envelope", color: "text-red-500" },
                { key: "fab_chat_zalo", text: "Zalo", href: "https://zalo.me/1582587135739746654", icon: "fas fa-comment-dots", color: "text-blue-500" },
                { key: "fab_fanpage_fb", text: "Facebook", href: "https://www.facebook.com/hr.ivsacademy/", icon: "fab fa-facebook-f", color: "text-blue-600" },
            ];
            element.innerHTML = contacts.map(c => `<a href="${c.href}" role="menuitem" class="fab-submenu-item group" data-lang-key="${c.key}" ${c.href.startsWith('http') ? 'target="_blank" rel="noopener noreferrer"' : ''}><i class="${c.icon} fa-fw ${c.color}"></i><span>${c.text}</span></a>`).join('');
        },

        populateShareOptions(element) {
            const currentUrl = window.location.href; 
            const pageTitle = document.title; 

            const shares = [
                { text: "Facebook", icon: "fab fa-facebook-f", color: "text-blue-600", action: `window.open('https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}', '_blank', 'noopener,noreferrer')` },
                { text: "X (Twitter)", icon: "fab fa-x-twitter", color: "text-neutral-500", action: `window.open('https://twitter.com/intent/tweet?url=${encodeURIComponent(currentUrl)}&text=${encodeURIComponent(pageTitle)}', '_blank', 'noopener,noreferrer')` },
                { text: "LinkedIn", icon: "fab fa-linkedin", color: "text-blue-700", action: `window.open('https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(currentUrl)}&title=${encodeURIComponent(pageTitle)}', '_blank', 'noopener,noreferrer')` },
                { 
                    text: "Copy Link", 
                    icon: "fas fa-link", 
                    color: "text-gray-500", 
                    action: `
                        try {
                            const textarea = document.createElement('textarea');
                            textarea.value = '${currentUrl}'; 
                            document.body.appendChild(textarea);
                            textarea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textarea);
                            componentLog('Đã sao chép liên kết vào clipboard!'); 
                        } catch (err) {
                            componentLog('Không thể sao chép liên kết: ' + err, 'error'); 
                        }
                    ` 
                }
            ];
            element.innerHTML = shares.map((s, index) => {
                const btnId = `share-action-${index}`;
                return `<button id="${btnId}" role="menuitem" class="fab-submenu-item group w-full"><i class="${s.icon} fa-fw ${s.color}"></i><span>${s.text}</span></button>`;
            }).join('');

            shares.forEach((s, index) => {
                const btn = document.getElementById(`share-action-${index}`);
                if (btn && s.action) {
                    if (s.text === "Copy Link") { 
                        btn.addEventListener('click', () => {
                            try {
                                const textarea = document.createElement('textarea');
                                textarea.value = currentUrl;
                                document.body.appendChild(textarea);
                                textarea.select();
                                document.execCommand('copy');
                                document.body.removeChild(textarea);
                                componentLog('Đã sao chép liên kết vào clipboard!');
                            } catch (err) {
                                componentLog('Không thể sao chép liên kết: ' + err, 'error');
                            }
                        });
                    } else {
                        btn.addEventListener('click', () => eval(s.action));
                    }
                }
            });
        },

        bindEvents() {
            if (this.scrollToTopBtn) {
                const handleScroll = () => {
                    if (window.scrollY > 200) {
                        this.scrollToTopBtn.classList.remove('opacity-0', 'scale-90', 'pointer-events-none');
                    } else {
                        this.scrollToTopBtn.classList.add('opacity-0', 'scale-90', 'pointer-events-none');
                    }
                };
                window.addEventListener('scroll', debounce(handleScroll, 100), { passive: true });
                this.scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
                handleScroll(); 
            }

            this.buttonsWithSubmenu.forEach(btn => btn.addEventListener('click', e => {
                e.stopPropagation();
                this.toggleSubmenu(btn);
            }));

            document.addEventListener('click', (e) => {
                if (!this.fabContainer.contains(e.target)) {
                    this.buttonsWithSubmenu.forEach(btn => this.closeSubmenu(btn));
                }
            });
        },

        toggleSubmenu(btn) {
            const isCurrentlyOpen = btn.getAttribute('aria-expanded') === 'true';
            this.buttonsWithSubmenu.forEach(otherBtn => {
                if (otherBtn !== btn) { 
                    this.closeSubmenu(otherBtn);
                }
            });
            if (!isCurrentlyOpen) this.openSubmenu(btn);
            else this.closeSubmenu(btn); 
        },

        openSubmenu(btn) {
            const menu = document.getElementById(btn.getAttribute('aria-controls'));
            if (!menu) return;
            menu.classList.remove('hidden', 'pointer-events-none'); 
            requestAnimationFrame(() => menu.classList.remove('opacity-0', 'scale-95'));
            btn.setAttribute('aria-expanded', 'true');
        },

        closeSubmenu(btn) {
            const menu = document.getElementById(btn.getAttribute('aria-controls'));
            if (!menu) return;
            menu.classList.add('opacity-0', 'scale-95');
            const onTransitionEnd = () => {
                if (menu.classList.contains('opacity-0')) {
                    menu.classList.add('hidden', 'pointer-events-none'); 
                }
                menu.removeEventListener('transitionend', onTransitionEnd);
            };
            menu.addEventListener('transitionend', onTransitionEnd);
            btn.setAttribute('aria-expanded', 'false');
        },
    };

    // Xuất IVSFabController để loadComponents.js có thể truy cập
    window.IVSFabController = IVSFabController;

</script>
